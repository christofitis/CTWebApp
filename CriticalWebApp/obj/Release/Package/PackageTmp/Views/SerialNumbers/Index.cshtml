@model IEnumerable<CriticalWebApp.Models.SerialNumber>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Serial Number Lookup</h2>
@using (Html.BeginForm("Index", "SerialNumbers"))
{
    <div class="form-inline">
        <div class="text-primary">Search for a Serial #: <b class="text-info">@ViewBag.UserInput </b></div>
        <input class="form-control" autocomplete="off" type="text" name="serialNumberQuery" id="serialNumberQuery" placeholder="2r1234" />
    </div>



    <div class="form-inline">
        <div class="text-primary">Search Customer: <b class="text-info">@ViewBag.CustomerFirstName @ViewBag.CustomerLastName</b> </div>
        <input class="form-control" type="text" name="customerFirstNameQuery" id="customerFirstNameQuery" placeholder="First or Company Name" />
        <input class="form-control" type="text" name="customerLastNameQuery" id="customerFirstNameQuery" placeholder="Last Name" />
    </div>




    <div class="form-inline">
        <div class="text-primary">Search MFG Date Range:<b class="text-info"> @ViewBag.StartMFGDate @ViewBag.EndMFGDate</b></div>
        <input class="form-control" type="date" name="startDateQuery" id="startDateQueryInput" />
        <input class="form-control" type="date" name="endDateQuery" id="endDateQueryInput" />
    </div>


    <div class="form-inline">
        <div class="text-primary">Search Ship Date Range: <b class="text-info">@ViewBag.StartShipDate @ViewBag.EndShipDate</b></div>
        <input class="form-control" type="date" name="startShipDateQuery" id="startShipDateQueryInput" />
        <input class="form-control" type="date" name="endShipDateQuery" id="endShipDateQueryInput" />

        <input class="btn btn-default" type="submit" value="Search" id="shipDateSearchButton" />
    </div>
}




                @Html.ActionLink("Add", "Create", new { }, new { @class = "btn btn-primary pull-right" })



                <table class="table table-hover">
                    <tr >
                        <th>
                            Serial Number
                        </th>
                        <th>
                            Product
                        </th>
                        <th>
                            Hardware Revision
                        </th>

                        <th>
                            Software Revision
                        </th>
                        <th>
                            MFG Date
                        </th>
                        <th>
                            Customer
                        </th>
                        <th>
                            Ship Date
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Notes)
                        </th>
                        

                    </tr>

                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                <b>@Html.ActionLink((@Html.DisplayFor(modelItem => item.Number).ToString()), "Details", new { id = item.Id })</b>
                            </td>
                         
                            <td>
                                @Html.DisplayFor(modelItem => item.Product.Name)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Product.HardwareRevision)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Product.SoftwareRevision)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.MFGDate)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.CustomerFirstName) @Html.DisplayFor(modelItem => item.CustomerLastName)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.ShipDate)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Notes)
                            </td>

                        </tr>
                    }

                </table>
                <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>

                <script>
                    $(document).ready(function () {
                        @*document.getElementById('serialNumberQuery').value = '@ViewBag.UserInput';
                        document.getElementById('startDateQueryInput').valueAsDate = '@ViewBag.StartMFGDate';
                        document.getElementById('endDateQueryInput').value = '@ViewBag.EndMFGDate';
                        document.getElementById('startShipDateQueryInput').value = '@ViewBag.StartShipDate';
                        document.getElementById('endShipDateQueryInput').value = '@ViewBag.EndShipDate';
                        document.getElementById('customerFirstNameQuery').value = '@ViewBag.CustomerFirstName';
                        document.getElementById('customerLastNameQuery').value = '@ViewBag.CustomerLastName';*@




                        startShipDateQueryInput

                        document.getElementById('serialNumberQuery').focus();
                    });


                    //can do studd depending is search box is left empty or not
                    document.getElementById('searchButton').onclick = function () {
                        var queryNum = document.getElementById('serialNumberQuery').value;
                        console.log('Searching for: ' + queryNum);
                        if (document.getElementById('serialNumberQuery').value == "") {
                            //alert('blank');
                        }
                        else {
                            document.getElementById('serialNumberQuery').value = queryNum;





                            var searchQuery = {
                                numberQuery: queryNum

                            };
                            console.log(searchQuery.numberQuery);
                            $.ajax({
                                type: 'GET',
                                url: '/api/serialnumbers/',
                                data: searchQuery,
                                success: function (result) {
                                    if (result[0] == null) {
                                        //alert('nothing found');
                                    }
                                    else {
                                        //alert('found: ' + result.length + ' items');
                                    }
                                }
                            });
                        }
                    };

                </script>
