@model IEnumerable<CriticalWebApp.Models.SerialNumber>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Serial Number Lookup</h2>
@using (Html.BeginForm("Index", "SerialNumbers"))
{
    <div>Search for a Serial #: </div>
    <input type="text" name="serialNumberQuery" id="serialNumberQuery" placeholder=""/>
    <input type="submit" value="Search" id="searchButton" />
}

@using (Html.BeginForm("Index", "SerialNumbers"))
{     <div>Search a date range: </div>
     <input type="date" name="startDateQuery" id="startDateQueryInput" />
     <input type="date" name="endDateQuery" id="endDateQueryInput" />
    <input type="submit" value="Search" id="dateSearchButton" />
}



@Html.ActionLink("Add", "Create", new { }, new { @class = "btn btn-primary pull-right" })



<table class="table table-striped">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Number)
        </th>
        <th>
            Product: Revision
        </th>

        <th>
            @Html.DisplayNameFor(model => model.MFGDate)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Notes)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Number)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Product.Name): @Html.DisplayFor(modelItem => item.Product.HardwareRevision)
            </td>



            <td>
                @Html.DisplayFor(modelItem => item.MFGDate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Notes)
            </td>

        </tr>
    }

</table>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>

<script>
    $(document).ready(function () {
        document.getElementById('serialNumberQuery').value = '@ViewBag.UserInput';
        document.getElementById('startDateQueryInput').valueAsDate = '@ViewBag.StartDate';
        document.getElementById('endDateQueryInput').value = '@ViewBag.EndDate';

        document.getElementById('serialNumberQuery').focus();
    });


    //can do studd depending is search box is left empty or not
    document.getElementById('searchButton').onclick = function () {
        var queryNum = document.getElementById('serialNumberQuery').value;
        console.log('Searching for: ' + queryNum);
        if (document.getElementById('serialNumberQuery').value == "") {
            //alert('blank');
        }
        else {
            document.getElementById('serialNumberQuery').value = queryNum;





            var searchQuery = {
                numberQuery: queryNum
                
            };
            console.log(searchQuery.numberQuery);
            $.ajax({
                type: 'GET',
                url: '/api/serialnumbers/',
                data: searchQuery,
                success: function (result) {
                    if (result[0] == null) {
                        //alert('nothing found');
                    }
                    else {
                        //alert('found: ' + result.length + ' items');
                    }
                }
            });
        }
    };

</script>